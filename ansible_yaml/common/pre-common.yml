- name: Set ansible_python_interpreter to use the installed Python
  set_fact:
    ansible_python_interpreter: /usr/bin/python3

- name: Load Traefik source config
  set_fact:
    traefik_source_config: "{{ lookup('file', playbook_dir + '/extra/{{ project_name }}.yml') | from_yaml }}"

- name: Transform Traefik config (placeholders -> prefix -> labels)
  set_fact:
    traefik_labels_list: "{{ (traefik_source_config
      | replace_placeholders(domain, traefik_certresolver)
      | apply_prefix(traefik_router_prefix)
      ) | flatten_to_labels }}"

- name: Ensure docker compose directory exists
  file:
    path: "{{ docker_compose_dir }}"
    state: directory
    mode: '0755'
  become: true

- name: Ensure docker compose directory exists
  file:
    path: "{{ docker_compose_dir }}/data"
    state: directory
    mode: '0755'
  become: true
